<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Landa Quantum – Troubleshoot Suite</title>

<!-- Favicon: העיגול הכחול שאהבת (מקודד, ללא קובץ חיצוני) -->
<link rel="icon" href="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>
  <defs>
    <radialGradient id='g' cx='50%' cy='50%' r='60%'>
      <stop offset='0%' stop-color='%2300aeef'/>
      <stop offset='100%' stop-color='%23008ec6'/>
    </radialGradient>
  </defs>
  <rect width='64' height='64' rx='14' ry='14' fill='%23091016'/>
  <circle cx='32' cy='32' r='14' fill='url(%23g)'/>
</svg>" />

<style>
:root{
  --bg:#060a12; --bg2:#0b111d;
  --glassA:rgba(255,255,255,.10); --glassB:rgba(255,255,255,.04);
  --border:rgba(255,255,255,.12);
  --text:#eaf4ff; --muted:#9fb4cc; --accent:#00aeef;
  --ok:#26d07c; --err:#ff5470;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  color:var(--text);
  background:radial-gradient(1200px 800px at 20% 30%, rgba(0,174,239,.18), transparent 60%),
             radial-gradient(1000px 900px at 80% 70%, rgba(0,174,239,.12), transparent 65%),
             linear-gradient(180deg,var(--bg),var(--bg2));
  overflow:hidden;
}

/* Canvas כוכבים רקע */
#stars{position:fixed;inset:0;z-index:0;display:block}

/* מחלקות כלליות */
.hidden{display:none!important}
.center{display:flex;align-items:center;justify-content:center}
.glass{
  background:linear-gradient(180deg,var(--glassA),var(--glassB));
  border:1px solid var(--border);
  backdrop-filter:blur(18px) saturate(1.25);
  -webkit-backdrop-filter:blur(18px) saturate(1.25);
  box-shadow:0 28px 80px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.05);
}
.page{position:relative;z-index:2;height:100%;overflow:auto}
.wrap{height:100%;padding:24px}

/* ===== לוגו (מקודד – ללא עיגול בתוך a, נקי ואחיד בכל העמודים) ===== */
.brand{display:flex;align-items:center;gap:10px}
.brand .logo{
  display:flex;flex-direction:column;align-items:flex-start;user-select:none
}
.logo-row{display:flex;align-items:flex-end;gap:3px;line-height:1;letter-spacing:.5px;text-shadow:0 6px 24px rgba(0,174,239,.35)}
.logo-L{
  font-weight:300;font-size:28px;letter-spacing:-2px;
  background:linear-gradient(180deg,rgba(255,255,255,.95),rgba(220,235,255,.55));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.logo-text{
  font-weight:200;font-size:28px;margin-left:4px;
  background:linear-gradient(180deg,rgba(255,255,255,.95),rgba(220,230,255,.45));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.logo-sub{margin-top:2px;font-size:10px;letter-spacing:2px;color:rgba(220,240,255,.85);text-shadow:0 0 10px rgba(0,174,239,.35)}
/* גרסאות גדלים */
.logo-xl .logo-L,.logo-xl .logo-text{font-size:56px}
.logo-xl .logo-sub{font-size:12px}
.logo-sm .logo-L,.logo-sm .logo-text{font-size:18px}
.logo-sm .logo-sub{font-size:9px}

/* ===== LOGIN ===== */
.login-wrap{height:100%;display:flex;align-items:center;justify-content:center;padding:28px}
.login-card{width:min(460px,92vw);border-radius:20px;padding:34px 28px 28px;animation:pop .6s ease}
@keyframes pop{from{opacity:0;transform:translateY(12px) scale(.97)}to{opacity:1;transform:translateY(0) scale(1)}}
.title{margin:18px 0 6px;font-size:22px;font-weight:600;text-align:center}
.subtitle{text-align:center;color:var(--muted);font-size:14px;margin-bottom:18px}
.input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--border);
  background:rgba(255,255,255,.05);color:var(--text);outline:none;transition:border .2s, box-shadow .2s}
.input:focus{border-color:rgba(0,174,239,.7);box-shadow:0 0 0 3px rgba(0,174,239,.18)}
.btn{border:1px solid var(--border);background:linear-gradient(180deg, rgba(0,174,239,.35), rgba(0,174,239,.15));
  color:white;padding:10px 16px;border-radius:12px;cursor:pointer;box-shadow:0 10px 30px rgba(0,174,239,.25);
  transition:transform .15s, box-shadow .2s, background .2s}
.btn:hover{transform:translateY(-1px);box-shadow:0 18px 40px rgba(0,174,239,.3);background:linear-gradient(180deg, rgba(0,174,239,.45), rgba(0,174,239,.2))}
.btn:active{transform:translateY(0) scale(.99)}
.login-actions{margin-top:10px;display:flex;gap:10px;justify-content:center}

/* ===== SHELL (אחרי התחברות) ===== */
.shell{display:grid;grid-template-columns:260px 1fr;gap:16px;height:100%}
.sidebar{padding:16px;border-radius:16px}
.nav .item{display:block;padding:12px 14px;border:1px solid var(--border);border-radius:12px;margin-bottom:10px;text-decoration:none;color:var(--text);background:rgba(255,255,255,.04);transition:.2s}
.nav .item:hover{background:rgba(255,255,255,.06)}
.nav .item.active{outline:2px solid rgba(0,174,239,.4)}

.topbar{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-radius:16px;margin-bottom:16px}
.content{padding:16px;border-radius:16px}

/* ===== DASHBOARD ===== */
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.kpi{padding:16px;border-radius:14px}
.kpi .num{font-size:28px;font-weight:700;margin-top:6px}

/* ===== CREATE CASE ===== */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.full{grid-column:1/-1}
.badge{display:inline-flex;gap:6px;border:1px solid var(--border);border-radius:999px;padding:6px 10px;background:rgba(255,255,255,.04)}
.badge .tbtn{border:none;background:transparent;color:var(--text);cursor:pointer;opacity:.6}
.badge .tbtn.active{opacity:1;text-decoration:underline}
.inline{display:flex;gap:8px;align-items:center}
.small{padding:8px 10px;border-radius:10px}
.danger{border:1px solid rgba(255,84,112,.45);background:rgba(255,84,112,.15)}

/* ===== CASES ===== */
.case-card{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;padding:12px;border-radius:12px;margin-bottom:10px}
.case-card .title{margin:0;font-size:16px}

/* Toasts */
.toasts{position:fixed;top:20px;right:20px;z-index:5;display:flex;flex-direction:column;gap:8px}
.toast{padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:rgba(9,16,28,.9);box-shadow:0 12px 24px rgba(0,0,0,.35)}
.toast.ok{border-color:rgba(38,208,124,.6)} .toast.err{border-color:var(--err)}

@media (max-width:980px){
  .shell{grid-template-columns:1fr}
  .sidebar{order:2}
  .topbar{order:1}
}
@media (max-width:640px){
  .grid{grid-template-columns:1fr}
  .kpis{grid-template-columns:1fr}
}
</style>
</head>
<body>
<canvas id="stars"></canvas>

<!-- ===== LOGIN PAGE ===== -->
<section id="page-auth" class="page login-wrap">
  <div class="login-card glass">
    <div class="brand center" style="margin-bottom:10px">
      <div class="logo logo-xl">
        <div class="logo-row"><div class="logo-L">L</div><div class="logo-text">anda</div></div>
        <div class="logo-sub">DIGITAL&nbsp;PRINTING</div>
      </div>
    </div>
    <div class="title">Landa Quantum – Access Portal</div>
    <div class="subtitle">Authorized personnel only</div>

    <div style="display:flex;flex-direction:column;gap:12px;margin-top:10px">
      <input class="input" id="authUser" placeholder="Username" autocomplete="username">
      <input class="input" id="authPass" type="password" placeholder="Password" autocomplete="current-password">
    </div>
    <div class="login-actions">
      <button class="btn" id="loginBtn">Sign In</button>
    </div>
    <div class="subtitle" style="margin-top:8px;opacity:.8">Users: <b>Expert/Landa123456</b> or <b>User/LandaUser</b></div>
  </div>
</section>

<!-- ===== APP SHELL ===== -->
<section id="page-app" class="page hidden">
  <div class="wrap">
    <div class="shell">
      <!-- Sidebar -->
      <aside class="sidebar glass">
        <div class="brand" style="margin-bottom:12px">
          <div class="logo logo-sm">
            <div class="logo-row"><div class="logo-L">L</div><div class="logo-text">anda</div></div>
            <div class="logo-sub">DIGITAL&nbsp;PRINTING</div>
          </div>
        </div>
        <nav class="nav">
          <a href="#" class="item active" data-route="dashboard">Dashboard</a>
          <a href="#" class="item" data-route="create">Create Case</a>
          <a href="#" class="item" data-route="cases">All Cases</a>
          <a href="#" class="item" data-route="settings">Settings</a>
        </nav>
      </aside>

      <!-- Main -->
      <main>
        <div class="topbar glass">
          <div class="brand">
            <div class="logo logo-sm">
              <div class="logo-row"><div class="logo-L">L</div><div class="logo-text">anda</div></div>
              <div class="logo-sub">DIGITAL&nbsp;PRINTING</div>
            </div>
          </div>
          <div class="inline">
            <div id="helloUser" class="subtitle" style="margin-right:10px">Welcome</div>
            <button class="btn small" id="btnLogout">Logout</button>
          </div>
        </div>

        <div class="content glass">
          <!-- DASHBOARD -->
          <section id="page-dashboard">
            <div class="kpis">
              <div class="kpi glass">
                <div class="subtitle">Total Cases</div>
                <div class="num" id="kpiTotal">0</div>
              </div>
              <div class="kpi glass">
                <div class="subtitle">With Parts</div>
                <div class="num" id="kpiParts">0</div>
              </div>
              <div class="kpi glass">
                <div class="subtitle">Last Update</div>
                <div class="num" id="kpiLast">—</div>
              </div>
            </div>
          </section>

          <!-- CREATE CASE -->
          <section id="page-create" class="hidden">
            <form id="caseForm" onsubmit="return false;">
              <div class="grid">
                <div>
                  <label class="subtitle">SF Case *</label>
                  <input class="input" id="sfCase" placeholder="e.g., S3-1042">
                </div>
                <div>
                  <label class="subtitle">TFS (optional)</label>
                  <input class="input" id="tfsNumber" placeholder="e.g., TFS-7789">
                </div>

                <div class="full">
                  <label class="subtitle">Machine</label><br>
                  <span class="badge">
                    <button type="button" data-type="Simplex" class="tbtn active">Simplex</button>
                    <button type="button" data-type="Duplex" class="tbtn">Duplex</button>
                  </span>
                  <input type="hidden" id="machineType" value="Simplex">
                </div>
                <div>
                  <label class="subtitle">Machine Number *</label>
                  <select class="input" id="machineNumber"></select>
                </div>
                <div>
                  <label class="subtitle">System *</label>
                  <select class="input" id="system"></select>
                </div>
                <div>
                  <label class="subtitle">Sub-System</label>
                  <select class="input" id="subSystem"></select>
                </div>

                <div class="full">
                  <label class="subtitle">Issue Summary *</label>
                  <input class="input" id="issueSummary" placeholder="Short summary">
                </div>

                <div class="full">
                  <label class="subtitle">Troubleshooting (add steps)</label>
                  <div id="tsList"></div>
                  <button type="button" class="btn small" id="btnAddTS">+ Add Step</button>
                </div>

                <div class="full">
                  <label class="subtitle">Parts</label>
                  <input class="input" id="parts" placeholder="Parts, serials…">
                </div>

                <div class="full">
                  <label class="subtitle">Solution *</label>
                  <textarea class="input" id="solution" rows="3" placeholder="What solved it?"></textarea>
                </div>

                <div class="full">
                  <label class="subtitle">Attachments</label>
                  <div id="filesWrap"></div>
                  <button type="button" class="btn small" id="btnAddFile">+ Add File</button>
                </div>

                <div class="full inline" style="justify-content:flex-end;margin-top:10px">
                  <button class="btn" id="btnSave">Save Case</button>
                </div>
              </div>
            </form>
          </section>

          <!-- CASES -->
          <section id="page-cases" class="hidden">
            <div id="casesList"></div>
          </section>

          <!-- SETTINGS (placeholder) -->
          <section id="page-settings" class="hidden">
            <div class="subtitle">Settings will be here…</div>
          </section>
        </div>
      </main>
    </div>
  </div>
</section>

<div class="toasts" id="toasts"></div>

<script>
/* ===== Starfield background ===== */
(function(){
  const c=document.getElementById('stars'),x=c.getContext('2d');let s=[];
  function R(){c.width=innerWidth;c.height=innerHeight}
  function I(){s=[];for(let i=0;i<140;i++)s.push({x:Math.random()*innerWidth,y:Math.random()*innerHeight,r:Math.random()*1.4+.2,v:Math.random()*.3+.05,a:Math.random()})}
  function T(){x.clearRect(0,0,innerWidth,innerHeight);for(const p of s){p.y+=p.v;if(p.y>innerHeight)p.y=-2;p.a+=.02;const g=.6+.4*Math.sin(p.a);x.beginPath();x.fillStyle='rgba(160,220,255,'+g+')';x.arc(p.x,p.y,p.r,0,Math.PI*2);x.fill()}requestAnimationFrame(T)}
  addEventListener('resize',R);R();I();T();
})();

/* ===== Toast helper ===== */
function toast(m,t='ok'){const d=document.createElement('div');d.className='toast '+t;d.textContent=m;toasts.appendChild(d);setTimeout(()=>d.remove(),2200)}

/* ===== Simple Router ===== */
const routes=['dashboard','create','cases','settings'];
document.querySelectorAll('.nav .item').forEach(a=>{
  a.onclick=e=>{e.preventDefault();go(a.dataset.route)}
});
function go(r){
  routes.forEach(id=>document.getElementById('page-'+id).classList.add('hidden'));
  document.getElementById('page-'+r).classList.remove('hidden');
  document.querySelectorAll('.nav .item').forEach(a=>a.classList.toggle('active',a.dataset.route===r));
  if(r==='dashboard') updateKPIs();
  if(r==='cases') renderCases();
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ===== Login / Logout ===== */
const loginBtn = document.getElementById('loginBtn');
loginBtn.addEventListener('click', ()=>{
  const u=authUser.value.trim(), p=authPass.value.trim();
  const ok = (u==='Expert' && p==='Landa123456') || (u==='User' && p==='LandaUser');
  if(ok){
    helloUser.textContent='Hello, '+u;
    document.getElementById('page-auth').classList.add('hidden');
    document.getElementById('page-app').classList.remove('hidden');
    go('dashboard');
    toast('Access Granted','ok');
  }else{
    toast('Invalid credentials','err');
  }
});
document.getElementById('btnLogout').onclick=()=>{
  document.getElementById('page-app').classList.add('hidden');
  document.getElementById('page-auth').classList.remove('hidden');
};

/* ===== Local Storage ===== */
const LS='landa_cases_v15';
const getCases=()=>{try{return JSON.parse(localStorage.getItem(LS)||'[]')}catch(e){return[]}};
const setCases=a=>{localStorage.setItem(LS,JSON.stringify(a));updateKPIs()};

/* ===== Machine/System Data ===== */
const MACHINES={Simplex:['S2','S3','S5','S7'],Duplex:['D3','D5','D7','D9']};
const SYSTEMS=['BSS','STS','IPS','BCU','IRD','Hot Air','PSS','CWS','Ventilation','MSPS','ITS','EC','DFE','PQ','QCS','PC Cabinet','ICS'];
const SUBSETS={
  'BSS':['Sensors','Interface','Controller','Transport','Software','Power']
};

/* Populate selects */
(function(){
  SYSTEMS.forEach(s=>{const o=document.createElement('option');o.textContent=s;system.appendChild(o)});
  system.onchange=()=>{const list=SUBSETS[system.value]||['General','Sensors','Controller','Power','Cooling','Software'];subSystem.innerHTML='';list.forEach(v=>{const o=document.createElement('option');o.textContent=v;subSystem.appendChild(o)})}
  function loadNums(){machineNumber.innerHTML='';(MACHINES[machineType.value]||[]).forEach(n=>{const o=document.createElement('option');o.textContent=n;machineNumber.appendChild(o)})}
  document.querySelectorAll('.tbtn').forEach(b=>b.onclick=()=>{document.querySelectorAll('.tbtn').forEach(x=>x.classList.remove('active'));b.classList.add('active');machineType.value=b.dataset.type;loadNums()});
  loadNums(); system.dispatchEvent(new Event('change'));
})();

/* Troubleshooting steps + Files */
function addTS(v=''){const r=document.createElement('div');r.className='inline';r.style.marginBottom='6px';const i=document.createElement('input');i.className='input';i.placeholder='Step…';i.value=v;const rm=document.createElement('button');rm.className='btn small danger';rm.type='button';rm.textContent='Remove';rm.onclick=()=>r.remove();r.appendChild(i);r.appendChild(rm);tsList.appendChild(r)}
btnAddTS.onclick=()=>addTS(); addTS();

function addFileRow(){const row=document.createElement('div');row.className='inline';row.style.marginBottom='6px';const inp=document.createElement('input');inp.type='file';inp.className='input';inp.accept='.pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.zip';const rm=document.createElement('button');rm.className='btn small danger';rm.type='button';rm.textContent='Remove';rm.onclick=()=>row.remove();row.appendChild(inp);row.appendChild(rm);filesWrap.appendChild(row)}
btnAddFile.onclick=addFileRow; addFileRow();

/* Save Case */
btnSave.onclick=()=>{
  const req=v=>v && v.trim().length>0;
  const ts=Array.from(document.querySelectorAll('#tsList .input')).map(i=>i.value).filter(Boolean);
  const data={
    sfCase:sfCase.value, tfs:tfsNumber.value, machineType:machineType.value, machineNumber:machineNumber.value,
    system:system.value, subSystem:subSystem.value, issueSummary:issueSummary.value,
    troubleshooting:ts, parts:parts.value, solution:solution.value,
    created:new Date().toLocaleString(), author:helloUser.textContent.replace('Hello, ','')
  };
  const errs=['sfCase','machineNumber','system','issueSummary','solution'].filter(id=>!req(document.getElementById(id).value));
  if(errs.length){toast('Fill required: '+errs.join(', '),'err');return}
  const a=getCases(); a.push(data); setCases(a);
  toast('Case saved','ok'); renderCases(); go('cases');
};

/* Render Cases */
function renderCases(){
  const a=getCases(); casesList.innerHTML='';
  if(!a.length){casesList.innerHTML='<div class="glass" style="padding:12px;border-radius:12px">No cases yet.</div>'; return}
  a.forEach((c,i)=>{
    const el=document.createElement('div'); el.className='case-card glass';
    el.innerHTML=`
      <div>
        <div class="title">#${i+1} – ${c.sfCase}</div>
        <div class="subtitle" style="margin:2px 0">${c.machineNumber} (${c.machineType}) • ${c.system}</div>
        <div class="subtitle" style="opacity:.9">${c.issueSummary}</div>
      </div>
      <div class="inline">
        <button class="btn small" onclick="viewCase(${i})">View</button>
        <button class="btn small danger" onclick="delCase(${i})">Delete</button>
      </div>`;
    casesList.appendChild(el);
  });
}
function delCase(i){const a=getCases(); a.splice(i,1); setCases(a); renderCases()}
function viewCase(i){
  const c=getCases()[i]; if(!c) return;
  const html = `
    <div class="glass" style="padding:14px;border-radius:12px">
      <div class="title" style="text-align:left;margin:0 0 8px">Case #${i+1} – ${c.sfCase}</div>
      <div class="subtitle">Machine: ${c.machineNumber} (${c.machineType})</div>
      <div class="subtitle">System: ${c.system} / ${c.subSystem||'—'}</div>
      <div class="subtitle">Issue: ${c.issueSummary}</div>
      <div class="subtitle">Solution: ${c.solution}</div>
      <div class="subtitle">Created: ${c.created} by ${c.author||'Expert'}</div>
    </div>`;
  const w=window.open('','_blank','width=520,height=520'); w.document.write('<body style="background:#0b111d;color:#eaf4ff;font-family:Inter,sans-serif">'+html+'</body>');
}

/* KPIs */
function updateKPIs(){
  const a=getCases();
  kpiTotal.textContent=a.length;
  kpiParts.textContent=a.filter(x=>x.parts && x.parts.trim()).length;
  kpiLast.textContent=a.length? a[a.length-1].created : '—';
}

/* Init landing state */
updateKPIs(); renderCases();
</script>
</body>
</html>
