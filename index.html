<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Landa Quantum – Troubleshoot Suite (V18.8-Dynamic)</title>
<link rel="icon" type="image/svg+xml"
  href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'%3E%3Crect x='2' y='2' width='36' height='36' rx='8' fill='%23000000' opacity='0.85' stroke='%23ffffff10'/%3E%3Ccircle cx='20' cy='20' r='8' fill='%2300aeef'/%3E%3C/svg%3E">
<link rel="stylesheet" href="style.css">
</head>
<body>
<canvas id="particles"></canvas>
<div class="toast-wrap" id="toasts"></div>

<section id="loginPage">
  <div class="auth panel center">
    <div class="logo">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 360 110" aria-label="Landa Digital Printing">
        <defs>
          <linearGradient id="lg" x1="0" y="0" x2="0" y2="1"><stop offset="0%" stop-color="#00aeef"/><stop offset="100%" stop-color="#3bd0ff"/></linearGradient>
          <filter id="g" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        <text x="50%" y="50%" text-anchor="middle" fill="url(#lg)" filter="url(#g)"
              font-family="Segoe UI, Inter, system-ui, sans-serif" font-weight="700" font-size="56" letter-spacing="1">Landa</text>
        <text x="50%" y="82%" text-anchor="middle" fill="#9bb0d0"
              font-family="Segoe UI, Inter, system-ui, sans-serif" font-size="18" letter-spacing="2">Digital Printing</text>
      </svg>
      <div class="subtitle">Quantum Troubleshoot Suite</div>
    </div>
    <h2>Sign in to continue</h2>
    <label class="label" for="authUser">Username</label>
    <input class="input" id="authUser" placeholder="Expert" autocomplete="username">
    <label class="label" for="authPass">Password</label>
    <input class="input" id="authPass" type="password" placeholder="Password" autocomplete="current-password">
    <button class="btn primary full" id="btnLogin">Login</button>
  </div>
</section>

<div class="app hidden" id="appRoot">
  <header class="header">
    <div class="header-left">
      <button class="menu-btn btn small" id="btnMenu" aria-label="Toggle menu" title="Menu">
        <span class="bar"></span><span class="bar"></span><span class="bar"></span>
      </button>
      <div class="header-title" id="logoHome" title="Go to Dashboard" style="cursor:pointer">
        <div class="logo-mini" aria-hidden="true">
          <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
            <rect x="2" y="2" width="36" height="36" rx="8" fill="rgba(0,0,0,0.78)" stroke="rgba(255,255,255,0.08)"/>
            <circle cx="20" cy="20" r="8" fill="#00aeef">
              <animate attributeName="r" values="8;9;8" dur="2.6s" repeatCount="indefinite"/>
            </circle>
          </svg>
        </div>
        <h1>Landa Quantum – Troubleshoot Suite</h1>
      </div>
    </div>
    <span class="badge-env">V18.8-Dynamic</span>
  </header>

  <div class="wrap">
    <aside class="aside" id="aside">
      <nav class="nav">
        <a class="item active" href="#" data-route="dashboard"><span>Dashboard</span></a>
        <a class="item" href="#" data-route="create"><span>Create Case</span></a>
        <a class="item" href="#" data-route="cases"><span>All Cases</span><span class="badge" id="casesCount">0</span></a>
        <a class="item" href="#" data-route="diagnosis"><span>Root Cause Analyzer</span></a>
        <a class="item" href="#" data-route="settings"><span>Settings</span></a>
        <a class="item" href="#" id="btnLogout"><span>Logout</span></a>
      </nav>
    </aside>

    <main class="main">
      <section id="page-dashboard" class="page">
        <div class="grid cols-3">
          <div class="panel"><div class="title">Total Cases</div><div style="font-size:28px;margin-top:6px" id="kpiTotal">0</div><div class="help">All cases saved locally</div></div>
          <div class="panel"><div class="title">With Attachments</div><div style="font-size:28px;margin-top:6px" id="kpiFiles">0</div><div class="help">Cases containing files</div></div>
          <div class="panel"><div class="title">Last Updated</div><div style="font-size:28px;margin-top:6px" id="kpiUpdated">—</div><div class="help">Most recent save</div></div>
        </div>
        <div class="panel" style="margin-top:14px">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <div class="title">Quick Actions</div>
            <div>
              <button class="btn" onclick="go('create')">+ New Case</button>
              <button class="btn" onclick="go('cases')">View All</button>
              <button class="btn" onclick="exportCSV()">Export CSV</button>
            </div>
          </div>
        </div>
      </section>

      <section id="page-create" class="page hidden">
        <div class="panel">
          <h2 style="margin:0 0 10px">Create New Case</h2>
          <form id="caseForm" onsubmit="saveCase(event)">
            <div class="grid cols-2">

              <div>
                <label class="label v13">Machine Type *</label>
                <div class="chips" id="machineTypeChips">
                  <div class="chip active" data-type="Simplex">Simplex</div>
                  <div class="chip" data-type="Duplex">Duplex</div>
                </div>
                <input type="hidden" id="machineType" value="Simplex">
              </div>
              <div>
                <label class="label v13">Model *</label>
                <div id="dd-model" class="dd field-model"></div>
              </div>

              <div>
                <label class="label v13">SF Case *</label>
                <input class="input v13 field-sf" id="sfCase" inputmode="numeric" placeholder="123456">
              </div>
              <div>
                <label class="label v13">Software Version</label>
                <input class="input v13 field-sw" id="softwareVersion" placeholder="4.2.11">
              </div>

              <div>
                <label class="label v13">System *</label>
                <div id="dd-system" class="dd field-system"></div>
              </div>

              <div id="wrap-sub" class="hidden">
                <label class="label v13">Sub-System *</label>
                <div id="dd-sub" class="dd field-subsystem"></div>
              </div>

              <div id="wrap-cat" class="hidden">
                <label class="label v13">Category *</label>
                <div id="dd-cat" class="dd class="dd field-category"></div>
              </div>

              <div id="wrap-item" class="hidden">
                <label class="label v13">Item *</label>
                <div id="dd-item" class="dd field-item"></div>
              </div>

              <div class="fit-inline full">
                <div>
                  <label class="label v13">TFS</label>
                  <div class="fit-inline">
                    <input type="checkbox" id="tfsToggle" title="Enable TFS">
                    <input class="input v13 hidden" id="tfsNumber" inputmode="numeric" placeholder="TFS-12345" style="max-width:220px">
                  </div>
                </div>
              </div>

              <div class="full"><hr style="border:0; border-top:1px solid var(--border)"></div>

              <div class="full">
                <label class="label v13">Issue Summary *</label>
                <input class="input v13" id="issueSummary" placeholder="One line summary">
              </div>
              <div class="full">
                <label class="label v13">Symptoms / Error Messages</label>
                <textarea id="symptoms" class="input v13" placeholder="Short bullets or error codes"></textarea>
              </div>

              <div class="full">
                <label class="label v13">Troubleshooting (steps)</label>
                <div id="tsSteps" class="field-troubles"></div>
                <button class="btn small" type="button" onclick="addStep()">+ Add step</button>
              </div>
              <div class="full">
                <label class="label v13">Part (Catalog)</label>
                <div class="partwrap field-troubles">
                  <input class="input v13" id="partInput" placeholder="Type to search part number (e.g., 12-34567)…">
                  <div class="part-suggest" id="partSuggest"></div>
                </div>
              </div>

              <div class="full">
                <label class="label v13">Solution Implemented *</label>
                <textarea id="solution" class="input v13 field-troubles" placeholder="What fixed the issue"></textarea>
              </div>
              <div class="full">
                <label class="label v13">Verification Method</label>
                <input id="verification" class="input v13 field-troubles" placeholder="How did we verify the fix?">
              </div>
              <div class="full">
                <label class="label v13">Notes</label>
                <textarea id="notes" class="input v13 field-troubles" placeholder="Anything noteworthy for future cases"></textarea>
              </div>

              <div class="full">
                <label class="label v13">Attachments (multiple)</label>
                <div id="filesWrap"></div>
                <button class="btn small" type="button" onclick="addFileRow()">+ Add another file</button>
                <div class="help">Accepted: pdf, doc, xls, png, jpg, jpeg, zip</div>
              </div>

              <div class="inline full" style="margin-top:6px">
                <button class="btn primary" type="submit">Save Case</button>
                <button class="btn ghost" type="button" onclick="go('cases')">View All</button>
              </div>
            </div>
          </form>
        </div>
      </section>

      <section id="page-cases" class="page hidden">
        <div class="panel">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:10px">
            <h2 style="margin:0">All Cases</h2>
            <div class="inline" style="flex-wrap:wrap; gap:8px">
              <input id="searchBox" class="input v13" placeholder="Search text (Issue / Model / System)" style="min-width:220px">
              <button class="btn" onclick="renderCases()">Apply</button>
              <button class="btn" onclick="exportCSV()">Export CSV</button>
            </div>
          </div>
        </div>
        <div id="casesList" class="grid cols-1" style="margin-top:14px"></div>
      </section>

      <section id="page-diagnosis" class="page hidden">
        <div class="panel">
          <h2 style="margin:0 0 10px">Root Cause Analyzer – Fishbone Troubleshooter</h2>
          <p class="help">Follow the guided diagnostic to identify the source of a problem step-by-step.</p>
          <div id="diagContainer">
            <div id="diagSelect" class="panel" style="margin-top:10px">
              <h3 style="margin:0 0 10px">Select Issue to Diagnose</h3>
              <p class="help">Choose the problem type to start the guided analysis:</p>
              <div class="issue-grid">
                <div class="issue-card" onclick="startDiagnosis('setoff')">
                  <div class="title">SetOff</div><div class="sub">Drying / Coating</div>
                </div>
                <div class="issue-card" onclick="startDiagnosis('scratches')">
                  <div class="title">Scratches</div><div class="sub">Print / Blanket</div>
                </div>
                <div class="issue-card" onclick="startDiagnosis('uniformity')">
                  <div class="title">Uniformity</div><div class="sub">Density / Bands</div>
                </div>
                <div class="issue-card" onclick="startDiagnosis('jetting')">
                  <div class="title">Jetting</div><div class="sub">Nozzles / Missing</div>
                </div>
                <div class="issue-card" onclick="startDiagnosis('transfer')">
                  <div class="title">Transfer</div><div class="sub">Media / Adhesion</div>
                </div>
              </div>
              <div id="diagStep1" class="panel hidden" style="margin-top:10px">
                <h3>Problem: <span id="issueName" style="color:var(--accent)">—</span></h3>
                <p>Perform a print of the same job <b>with</b> and <b>without coating</b>, then examine the drying of both samples.</p>
                <div class="inline" style="justify-content:flex-end;margin:6px 0 10px">
                  <button class="btn small" type="button" onclick="backToIssueSelect()">← Change issue</button>
                </div>
                <div style="display:flex; flex-direction:column; gap:10px; margin-top:10px">
                  <button class="btn" onclick="selectDiagnosis('drying')">Job without coating is NOT properly dried</button>
                  <button class="btn" onclick="selectDiagnosis('coating')">Job with coating is NOT properly dried</button>
                  <button class="btn" onclick="selectDiagnosis('both')">Both samples are NOT properly dried</button>
                </div>
              </div>
              <div id="diagStep2" class="hidden" style="margin-top:14px"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="page-settings" class="page hidden">
        <div class="panel"><h2 style="margin:0 0 10px">Settings</h2><div class="help">Coming soon…</div></div>
      </section>
    </main>
  </div>

  <div class="fab" id="fabNew"><button class="btn primary" onclick="go('create')">+ New Case</button></div>

  <div class="modal-back" id="modalBack">
    <div class="modal" id="modal">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px">
        <div class="title" id="modalTitle">Case</div>
        <button class="btn small danger" onclick="closeModal()">Close</button>
      </div>
      <div id="modalBody" style="margin-top:12px"></div>
    </div>
  </div>
</div>

<script src="app.js"></script>
<script src="./data/setoff.js"></script>
<script src="rca.js"></script>
</body>
</html>
