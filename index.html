<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Landa SF Cases Management</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="Landa.png">
<style>
:root{
  --bg:#0b1016; --bg2:#0e1420;
  --text:#e8f0ff; --muted:#9bb0d0;
  --accent:#00aeef; --accent2:#3bd0ff;
  --border:rgba(255,255,255,0.1);
}
*{box-sizing:border-box}
body{
  margin:0;
  font:14px/1.45 system-ui,-apple-system,Segoe UI,Inter,Roboto,Helvetica,Arial;
  background:
    radial-gradient(1000px 500px at 20% -10%, rgba(0,174,239,.15), transparent 60%),
    radial-gradient(900px 400px at 120% 10%, rgba(59,208,255,.12), transparent 60%),
    linear-gradient(180deg, var(--bg), var(--bg2));
  color:var(--text);
}
.header{
  position:sticky;top:0;z-index:10;
  display:flex;align-items:center;gap:10px;padding:10px 16px;
  background:rgba(10,14,20,.7);backdrop-filter:blur(10px);
  border-bottom:1px solid var(--border);
}
.header img{height:28px;filter:drop-shadow(0 6px 18px rgba(0,174,239,.3));}
.header h1{font-size:16px;margin:0;opacity:.9;letter-spacing:.4px}
.panel{border:1px solid var(--border);border-radius:14px;padding:16px;
background:rgba(255,255,255,.04);box-shadow:0 8px 20px rgba(0,0,0,.3);}
.grid{display:grid;gap:14px}.cols-2{grid-template-columns:1fr 1fr}
.input,select,textarea{
  width:100%;padding:10px 12px;border:1px solid var(--border);
  border-radius:10px;background:rgba(255,255,255,.03);color:var(--text);
}
textarea{min-height:60px;resize:vertical}
.btn{border:1px solid var(--border);border-radius:10px;
padding:9px 14px;background:rgba(255,255,255,.05);color:var(--text);cursor:pointer}
.btn.primary{border-color:var(--accent);background:linear-gradient(180deg,rgba(0,174,239,.3),rgba(0,174,239,.1))}
.btn.small{padding:6px 10px;font-size:12px}
.hidden{display:none!important}
/* ========== המשך עיצוב ואנימציות ========== */
.toggle{display:flex;gap:8px;margin:6px 0}
.tbtn{padding:6px 12px;border-radius:999px;border:1px solid var(--border);
cursor:pointer;user-select:none;color:var(--muted);}
.tbtn.active{background:linear-gradient(180deg,rgba(0,174,239,.25),rgba(0,174,239,.08));color:#fff;box-shadow:0 0 8px rgba(0,174,239,.3);}
.case-card{border:1px solid var(--border);border-radius:14px;padding:14px;
display:grid;grid-template-columns:auto 1fr auto;gap:10px;
background:rgba(255,255,255,.04);box-shadow:0 8px 20px rgba(0,0,0,.3);}
.case-card .stripe{width:6px;border-radius:8px;background:linear-gradient(180deg,var(--accent),var(--accent2));}
.case-card .title{font-weight:600;opacity:.95}
.attach-empty{color:var(--muted);font-style:italic}

/* אפקט כניסה */
@keyframes pop{from{opacity:0;transform:translateY(6px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}
.page-enter{animation:pop .3s ease}

/* Login */
.login-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;
background:linear-gradient(180deg,var(--bg),var(--bg2));overflow:hidden;position:relative}
.login-card{position:relative;z-index:2;width:min(420px,94vw);
border:1px solid var(--border);border-radius:14px;padding:18px;
background:rgba(255,255,255,.05);backdrop-filter:blur(10px);
box-shadow:0 20px 60px rgba(0,0,0,.4);}
.particles{position:absolute;inset:0;pointer-events:none;opacity:.5}
.particle{position:absolute;width:2px;height:2px;background:rgba(59,208,255,.9);
border-radius:50%;box-shadow:0 0 8px rgba(59,208,255,.9);
animation:drift 16s linear infinite}
@keyframes drift{from{transform:translateY(0)}to{transform:translateY(-180vh)}}
</style>
</head>
<body>

<!-- LOGIN -->
<section id="loginScreen" class="login-wrap">
  <div class="particles" id="particles"></div>
  <div class="login-card">
    <div style="text-align:center;margin-bottom:10px">
      <img src="Landa.png" alt="Landa" style="height:38px;filter:drop-shadow(0 10px 25px rgba(0,174,239,.4))">
      <h2 style="margin:6px 0 0">Landa SF Cases Management</h2>
    </div>
    <label>User</label>
    <input class="input" id="authUser" value="Expert">
    <label>Password</label>
    <input class="input" id="authPass" type="password" placeholder="Password">
    <div style="margin-top:10px;text-align:center;font-size:12px;color:var(--muted)">Demo: <b>Expert / Landa123456</b></div>
    <div style="display:flex;gap:10px;margin-top:12px;justify-content:center">
      <button class="btn primary" id="btnLogin">Sign In</button>
      <button class="btn" id="btnFill">Fill</button>
    </div>
  </div>
</section>

<!-- APP -->
<div id="appRoot" class="hidden">
  <div class="header"><img src="Landa.png"><h1>Landa SF Cases Management</h1></div>
  <div class="grid" style="padding:18px" id="page-create">
    <div class="panel">
      <h2>Create New Case</h2>
      <form id="caseForm" onsubmit="saveCase(event)">
        <div class="grid cols-2">
          <div>
            <label>SF Case *</label>
            <input class="input" id="sfCase">
          </div>
          <div>
            <label><input type="checkbox" id="tfsToggle"> Add TFS Number</label>
            <input class="input hidden" id="tfsNumber">
          </div>

          <div class="full">
            <label>Machine Type *</label>
            <div class="toggle" id="typeToggle">
              <span class="tbtn active" data-type="Simplex">Simplex</span>
              <span class="tbtn" data-type="Duplex">Duplex</span>
            </div>
            <input type="hidden" id="machineType" value="Simplex">
          </div>
          <div>
            <label>Machine Number *</label>
            <select class="input" id="machineNumber"></select>
          </div>
          <div>
            <label>Software Version</label>
            <input class="input" id="softwareVersion">
          </div>

          <div>
            <label>System *</label>
            <select class="input" id="system"></select>
          </div>
          <div>
            <label>Sub-System</label>
            <select class="input" id="subSystem"></select>
          </div>

          <div class="full">
            <label>Issue Summary *</label>
            <input class="input" id="issueSummary" placeholder="Short summary">
          </div>
          <div>
            <label>Symptoms</label>
            <input class="input" id="symptoms">
          </div>
          <div>
            <label>Frequency</label>
            <select id="frequency" class="input">
              <option>Once</option><option>Intermittent</option><option>Frequent</option><option>Constant</option>
            </select>
          </div>
          <div class="full">
            <label>Environment</label>
            <input id="environment" class="input">
          </div>

          <div class="full">
            <label>Reproduction Steps</label>
            <textarea id="repro" class="input"></textarea>
          </div>
          <div class="full">
            <label>Root Cause</label>
            <textarea id="rootCause" class="input"></textarea>
          </div>
          <div class="full">
            <label>Analysis Notes</label>
            <textarea id="analysis" class="input"></textarea>
          </div>

          <div class="full">
            <label>Troubleshooting Steps</label>
            <div id="tsList"></div>
            <button class="btn small" type="button" onclick="addTS()">+ Add Step</button>
          </div>

          <div class="full">
            <label>Parts / Service Actions</label>
            <textarea id="parts" class="input" style="min-height:56px"></textarea>
          </div>
          <div class="full">
            <label>Solution Implemented *</label>
            <textarea id="solution" class="input" style="min-height:56px"></textarea>
          </div>
          <div class="full">
            <label>Verification Method</label>
            <input id="verification" class="input">
          </div>

          <div class="full">
            <label>Attachments (multiple)</label>
            <div id="filesWrap"></div>
            <button class="btn small" type="button" onclick="addFileRow()">+ Add another file</button>
          </div>

          <div class="full" style="margin-top:10px">
            <button class="btn primary" type="submit">Save Case</button>
          </div>
        </div>
      </form>
    </div>

    <div class="panel" id="casesList" style="margin-top:20px"></div>
  </div>
</div>

<script>
/* particles */
(function(){const w=document.getElementById('particles');for(let i=0;i<40;i++){const d=document.createElement('div');d.className='particle';d.style.left=Math.random()*100+'%';d.style.top=(60+Math.random()*60)+'%';d.style.animationDuration=(12+Math.random()*12)+'s';w.appendChild(d);}})();

/* login */
btnFill.onclick=()=>{authUser.value='Expert';authPass.value='Landa123456';}
btnLogin.onclick=()=>{
  if(authUser.value.trim()==='Expert' && authPass.value==='Landa123456'){
    loginScreen.classList.add('hidden');appRoot.classList.remove('hidden');
    toast('Welcome, Expert','ok');loadMachines();loadSystems();
  }else toast('Invalid credentials','err');
};

/* toggles */
const MACHINES={Simplex:['S2','S3','S5','S7'],Duplex:['D3','D5','D7','D9']};
const SYSTEMS=['BSS','STS','IPS','BCU','IRD','Hot Air','PSS','CWS','Ventilation','MSPS','ITS','EC','DFE','PQ','QCS','PC Cabinet','ICS'];
const SUBSETS={'BSS':['Sensors','Interface','Controller','Transport','Software','Power']};
const numSel=document.getElementById('machineNumber'), sysSel=document.getElementById('system'), subSel=document.getElementById('subSystem');
function loadMachines(){numSel.innerHTML='';(MACHINES[machineType.value]||[]).forEach(m=>{const o=document.createElement('option');o.textContent=m;numSel.appendChild(o);});}
function loadSystems(){sysSel.innerHTML='';SYSTEMS.forEach(s=>{const o=document.createElement('option');o.textContent=s;sysSel.appendChild(o);});}
typeToggle.querySelectorAll('.tbtn').forEach(btn=>{
  btn.onclick=()=>{typeToggle.querySelectorAll('.tbtn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');machineType.value=btn.dataset.type;loadMachines();}
});
tfsToggle.onchange=()=>tfsNumber.classList.toggle('hidden',!tfsToggle.checked);

/* troubleshooting dynamic */
function addTS(v=''){const r=document.createElement('div');r.className='grid';r.innerHTML=`<input class="input" value="${v||''}" placeholder="Step...">`;tsList.appendChild(r);}
addTS();

/* files */
function addFileRow(){const w=document.getElementById('filesWrap');const r=document.createElement('div');r.className='grid';r.innerHTML=`<input type="file" class="input">`;w.appendChild(r);}
addFileRow();

/* storage */
const LS_KEY='landa_cases_v13_demo';
function getCases(){try{return JSON.parse(localStorage.getItem(LS_KEY)||'[]')}catch(e){return[]}}
function setCases(a){localStorage.setItem(LS_KEY,JSON.stringify(a));}

/* save */
async function saveCase(e){
  e.preventDefault();
  const req=v=>v&&v.trim().length>0;
  const steps=[...document.querySelectorAll('#tsList input')].map(i=>i.value).filter(Boolean);
  const data={sfCase:sfCase.value,tfs:tfsToggle.checked?tfsNumber.value:'',
  machineType:machineType.value,machineNumber:machineNumber.value,
  system:system.value,subSystem:subSystem.value,software:softwareVersion.value,
  issue:issueSummary.value,sym:symptoms.value,env:environment.value,
  repro:repro.value,root:rootCause.value,analysis:analysis.value,
  steps,parts:parts.value,solution:solution.value,verif:verification.value,
  created:new Date().toLocaleString(),author:'Expert'};
  const errors=['sfCase','machineNumber','system','issueSummary','solution'].filter(id=>!req(data[id]||eval(id)?.value));
  if(errors.length){toast('Fill required: '+errors.join(', '),'err');return;}
  const arr=getCases();arr.push(data);setCases(arr);toast('Case saved','ok');renderCases();
}

/* render */
function renderCases(){
  const a=getCases();if(!a.length){casesList.innerHTML='<div class="panel">No cases yet.</div>';return;}
  casesList.innerHTML=a.map((c,i)=>`
  <div class="case-card">
    <div class="stripe"></div>
    <div><div class="title">#${i+1} – ${c.sfCase}</div>
      <div style="font-size:13px;color:var(--muted)">${c.machineNumber} (${c.machineType}) • ${c.system}</div>
      <div style="margin-top:4px">Issue: ${c.issue}</div>
      <div style="font-size:12px;color:var(--muted);margin-top:3px">${(c.steps||[]).length} step(s)</div>
    </div>
    <div><button class="btn small" onclick="viewCase(${i})">View</button></div>
  </div>`).join('');
}
function viewCase(i){
  const c=getCases()[i];alert(
`Case ${i+1}: ${c.sfCase}
Machine: ${c.machineNumber} (${c.machineType})
System: ${c.system}
Issue: ${c.issue}
Solution: ${c.solution}`);
}

/* toast */
function toast(m,t){const d=document.createElement('div');d.className='btn '+(t==='err'?'danger':'primary');d.textContent=m;
Object.assign(d.style,{position:'fixed',right:'20px',top:'20px',zIndex:99});document.body.appendChild(d);
setTimeout(()=>d.remove(),2000);}
</script>
</body>
</html>
