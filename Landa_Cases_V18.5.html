<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Landa Cases – V18.5 (Full Build)</title>
<link rel="icon" href="Landa.png">
<style>
:root{
  --bg:#0b1016; --bg2:#0e1420; --panel:rgba(18,24,34,.6); --glass:rgba(22,30,45,.55);
  --text:#e8f0ff; --muted:#9bb0d0; --border:rgba(255,255,255,.08);
  --accent:#00aeef; --accent2:#3bd0ff; --ok:#4ade80; --err:#ff4967; --warn:#fbbf24;
  --shadow: 0 8px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
  --radius: 16px; --radius-lg: 22px;
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0; color:var(--text);
  background:
    radial-gradient(1200px 800px at 10% -10%, rgba(0,174,239,.15), transparent 60%),
    radial-gradient(900px 600px at 120% 20%, rgba(59,208,255,.12), transparent 60%),
    linear-gradient(180deg, var(--bg), var(--bg2) 50%, var(--bg));
  font:14px/1.6 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
}
a{color:var(--accent)}
.container{max-width:1200px;margin:0 auto;padding:20px}
.header{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:12px 16px; background:var(--glass); border:1px solid var(--border);
  box-shadow:var(--shadow); border-radius:var(--radius); backdrop-filter: blur(10px);
}
.brand{display:flex;align-items:center;gap:12px}
.brand img{width:34px;height:34px;object-fit:contain;filter:drop-shadow(0 2px 8px rgba(0,174,239,.35))}
.brand .title{font-weight:700; letter-spacing:.3px}
.badge{font-size:12px;color:#0c2732;background:linear-gradient(135deg,#8be9ff,#20c4ff);padding:4px 10px;border-radius:999px}

.controls{display:flex;align-items:center;gap:10px}
.toggle{
  display:inline-flex; align-items:center; background:var(--panel); border:1px solid var(--border);
  padding:4px; border-radius:999px; gap:4px;
}
.toggle button{
  border:0; background:transparent; color:var(--muted); padding:6px 10px; border-radius:999px; cursor:pointer;
  transition: transform .12s ease;
}
.toggle button:active{transform:scale(.98)}
.toggle button.active{background:rgba(255,255,255,.08); color:var(--text); box-shadow:inset 0 0 0 1px var(--border)}

.primary{
  display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:999px;
  border:1px solid var(--border); background:linear-gradient(180deg, rgba(0,174,239,.22), rgba(0,174,239,.18));
  box-shadow:var(--shadow); color:var(--text); cursor:pointer; transition:.18s transform, box-shadow .18s ease;
}
.primary:hover{box-shadow:0 10px 36px rgba(0,174,239,.28), inset 0 1px 0 rgba(255,255,255,.05)}
.primary:active{transform:translateY(1px)}
.primary .dot{width:8px;height:8px;border-radius:50%;background:var(--ok)}

.frame{
  margin-top:14px; display:grid; grid-template-columns: 280px 1fr; gap:14px;
}
@media (max-width: 980px){ .frame {grid-template-columns:1fr} }
.panel{
  background:var(--glass); border:1px solid var(--border); box-shadow:var(--shadow); border-radius:var(--radius-lg);
}
.nav{padding:10px}
.nav .section{padding:10px}
.nav a{
  display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; color:var(--text); text-decoration:none;
  transition: transform .12s ease;
}
.nav a[aria-current="page"]{background:rgba(255,255,255,.06)}
.nav a:hover{background:rgba(255,255,255,.08); transform: translateY(-1px)}
.nav .hint{font-size:12px;color:var(--muted);padding:6px 12px}

.content{padding:16px 16px 20px}
.toolbar{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:12px}
.toolbar .title{font-size:18px;font-weight:700;letter-spacing:.3px}
.toolbar .sub{font-size:12px;color:var(--muted)}
.toolbar .left-actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.toolbar .right-actions{display:flex;align-items:center;gap:10px}

.search{
  display:flex; align-items:center; gap:8px; background:rgba(255,255,255,.06); padding:8px 12px;
  border:1px solid var(--border); border-radius:12px;
}
.search input{background:transparent; border:0; outline:none; color:var(--text); width:240px}

.notice{
  padding:12px; border-radius:12px; background:rgba(59,208,255,.08); border:1px dashed rgba(59,208,255,.25);
  font-size:13px; color:#bfe9ff;
}

.grid{display:grid; gap:12px}
.grid.cols-2{grid-template-columns:1fr 1fr}
.grid.cols-3{grid-template-columns:repeat(3,1fr)}
@media (max-width: 980px){ .grid.cols-2, .grid.cols-3 {grid-template-columns:1fr} }

.card{padding:14px;border-radius:16px;border:1px solid var(--border);background:rgba(12,18,28,.5)}
.card h4{margin:0 0 8px 0;font-size:14px;letter-spacing:.2px}
.card p{margin:0;color:var(--muted);font-size:13px}
.kpi{display:flex;align-items:baseline;gap:8px}
.kpi .num{font-size:24px;font-weight:800}
.kpi .delta{font-size:12px;color:#ade8ff}

.hr{height:1px;background:linear-gradient(90deg, transparent, rgba(255,255,255,.08), transparent);margin:12px 0}

.hidden{display:none !important}
.muted{color:var(--muted)}
.helper{font-size:12px;color:var(--muted);margin-top:6px}

.form{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
.field{display:flex;flex-direction:column;gap:6px}
.field label{font-size:12px;color:var(--muted)}
.field input,.field select,.field textarea{
  background:rgba(255,255,255,.06); border:1px solid var(--border); color:var(--text);
  padding:10px 12px; border-radius:12px; outline:none; transition:border-color .15s ease, box-shadow .15s ease;
}
.field input:focus,.field select:focus,.field textarea:focus{
  border-color:rgba(59,208,255,.45); box-shadow:0 0 0 3px rgba(59,208,255,.18);
}
/* width control by data-size */
.field[data-size="xs"]{grid-column: span 2}
.field[data-size="sm"]{grid-column: span 3}
.field[data-size="md"]{grid-column: span 4}
.field[data-size="lg"]{grid-column: span 6}
.field[data-size="xl"]{grid-column: span 12}

.form .inline{display:flex;gap:10px;align-items:center}
.form .chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.06);cursor:pointer;transition:transform .12s ease, box-shadow .12s ease}
.chip.active{background:rgba(0,174,239,.18); box-shadow:0 4px 16px rgba(0,174,239,.18)}
.small{font-size:12px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

.step-list{display:flex;flex-direction:column;gap:8px;max-width:560px}
.step{display:flex;align-items:center;gap:8px}
.step input{flex:1}
.step .del{border:0;background:rgba(255,255,255,.06);border:1px solid var(--border);padding:8px 10px;border-radius:10px;color:#ff8fa0;cursor:pointer}

.partwrap{position:relative}
.part-suggest{
  position:absolute; left:0; right:0; top:100%; z-index:10; background:#0f1622; border:1px solid var(--border);
  border-radius:12px; box-shadow:var(--shadow); max-height:220px; overflow:auto; display:none
}
.part-suggest div{padding:8px 12px; cursor:pointer}
.part-suggest div:hover{background:rgba(255,255,255,.06)}

.footer{padding:12px 16px;color:var(--muted);font-size:12px;text-align:center}
</style>
</head>
<body>
<div class="container">
  <header class="header">
    <div class="brand">
      <img src="Landa.png" alt="Landa logo" onerror="this.style.display='none'">
      <div class="title">Landa Case Management</div>
      <span class="badge">V18.5</span>
    </div>
    <div class="controls">
      <div class="toggle" id="modeToggle">
        <button data-mode="dark" class="active">Dark</button>
        <button data-mode="light">Light</button>
      </div>
    </div>
  </header>

  <div class="frame">
    <nav class="panel nav">
      <div class="section">
        <a href="#dashboard" id="navDashboard" aria-current="page">Dashboard</a>
        <a href="#create" id="navCreate">Create New Case</a>
        <a href="#cases" id="navCases">All Cases</a>
      </div>
      <div class="hint">“New Case” מופיע בצד שמאל בסרגל הכלים של הדשבורד ומוסתר בעמוד יצירת קייסים.</div>
    </nav>

    <main class="panel content">
      <!-- Toolbar -->
      <div class="toolbar">
        <div class="left-actions">
          <button class="primary" id="btnNewCase">
            <span class="dot"></span> New Case
          </button>
          <div class="title" id="pageTitle">Dashboard</div>
          <div class="sub" id="pageSub">Quick insights & recent activity</div>
        </div>
        <div class="right-actions">
          <div class="search"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.3-4.3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.6" /></svg><input placeholder="Search cases…"></div>
        </div>
      </div>

      <!-- PAGES -->
      <section id="pageDashboard">
        <div class="grid cols-3">
          <div class="card">
            <h4>Open Cases</h4>
            <div class="kpi"><div class="num" id="kpiOpen">42</div><div class="delta">+3 today</div></div>
            <p>Active troubleshooting across systems.</p>
          </div>
          <div class="card">
            <h4>Avg. Time to First Response</h4>
            <div class="kpi"><div class="num">28m</div><div class="delta">-5m wk/wk</div></div>
            <p>Target &lt; 30m for all severities.</p>
          </div>
          <div class="card">
            <h4>Top Systems</h4>
            <div class="row small"><span class="chip active">Imaging</span><span class="chip">Feeder</span><span class="chip">Electronics</span><span class="chip">Dryer</span></div>
          </div>
        </div>
        <div class="hr"></div>
        <div class="notice">Visual uplift only (micro-interactions, focus rings, subtle depth). Structure, colors and layout stay identical to V18.4.</div>
      </section>

      <section id="pageCreate" class="hidden">
        <div class="notice">Create Case: same layout as V18.4 with requested behavior. System list updated to your official list. Subsystem placeholder appears after a System is chosen.</div>
        <form class="form" id="caseForm" onsubmit="event.preventDefault(); alert('Case saved (demo).');">
          <!-- Title / Severity / Site / Customer -->
          <div class="field" data-size="sm">
            <label>Title *</label>
            <input required placeholder="Short issue title">
          </div>
          <div class="field" data-size="xs">
            <label>Severity *</label>
            <select required>
              <option value="">Select…</option>
              <option>Low</option><option>Medium</option><option>High</option><option>Critical</option>
            </select>
          </div>
          <div class="field" data-size="xs">
            <label>Site ID</label>
            <input inputmode="numeric" pattern="[0-9]*" placeholder="e.g., 1024">
          </div>
          <div class="field" data-size="sm">
            <label>Customer</label>
            <input placeholder="Account / plant">
          </div>

          <!-- TFS optional via checkbox -->
          <div class="field" data-size="xs">
            <label class="inline"><input type="checkbox" id="tfsToggle"> Use TFS number</label>
            <div class="helper">Enable only when linking to dev tracker.</div>
          </div>
          <div class="field hidden" id="tfsField" data-size="sm">
            <label>TFS Number</label>
            <input type="text" inputmode="numeric" placeholder="TFS-12345">
          </div>

          <!-- Machine type → model list -->
          <div class="field" data-size="md">
            <label>Machine Type *</label>
            <div class="chips" id="machineType">
              <span class="chip active" data-type="simplex">Simplex</span>
              <span class="chip" data-type="duplex">Duplex</span>
            </div>
            <div class="helper">Choose type; a specific model list will appear accordingly.</div>
          </div>
          <div class="field" data-size="sm" id="modelField">
            <label>Model *</label>
            <select required id="modelSelect">
              <!-- populated by JS -->
            </select>
          </div>

          <!-- System → Subsystem -->
          <div class="field" data-size="md">
            <label>System *</label>
            <select required id="systemSelect">
              <option value="">Select system…</option>
            </select>
            <div class="helper">Subsystem list appears after selecting a system.</div>
          </div>
          <div class="field hidden" data-size="md" id="subsystemField">
            <label>Subsystem *</label>
            <select required id="subsystemSelect">
              <option value="">Select subsystem…</option>
            </select>
          </div>

          <!-- Part smart input -->
          <div class="field" data-size="lg">
            <label>Part</label>
            <div class="partwrap">
              <input id="partInput" placeholder="Type to search part number (e.g., 12-34567)…">
              <div class="part-suggest" id="partSuggest"></div>
            </div>
            <div class="helper">Start typing to pick a catalog part. Free text allowed.</div>
          </div>

          <!-- Troubleshooting steps -->
          <div class="field" data-size="lg">
            <label>Troubleshooting Steps</label>
            <div class="step-list" id="steps"></div>
            <div class="row">
              <button type="button" class="primary" id="addStep">Add step</button>
              <span class="small muted">Add or remove as needed.</span>
            </div>
          </div>

          <!-- Description -->
          <div class="field" data-size="xl">
            <label>Description</label>
            <textarea rows="4" placeholder="Compact summary of the issue and context…"></textarea>
          </div>

          <!-- Submit -->
          <div class="field" data-size="xl">
            <div class="row">
              <button class="primary" type="submit"><span class="dot"></span> Save Case</button>
              <span class="small muted">“New Case” is hidden on this page.</span>
            </div>
          </div>
        </form>
      </section>

      <section id="pageAllCases" class="hidden">
        <div class="notice">All Cases – placeholder grid (wired later).</div>
      </section>
    </main>
  </div>

  <footer class="footer">© Landa · V18.5 · Visual polish over V18.4, Systems updated, Subsystems placeholder ready</footer>
</div>

<script>
// Dark / Light mode
const modeToggle = document.getElementById('modeToggle');
modeToggle.addEventListener('click', (e)=>{
  if(e.target.tagName !== 'BUTTON') return;
  modeToggle.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
  e.target.classList.add('active');
  const mode = e.target.dataset.mode;
  document.documentElement.style.setProperty('--bg', mode==='light' ? '#f4f7fb' : '#0b1016');
  document.documentElement.style.setProperty('--bg2', mode==='light' ? '#eaf0f7' : '#0e1420');
  document.documentElement.style.setProperty('--text', mode==='light' ? '#0b1016' : '#e8f0ff');
  document.documentElement.style.setProperty('--muted', mode==='light' ? '#4a607a' : '#9bb0d0');
  document.body.style.background =
    mode==='light'
     ? 'linear-gradient(180deg, var(--bg), var(--bg2) 50%, var(--bg))'
     : 'radial-gradient(1200px 800px at 10% -10%, rgba(0,174,239,.15), transparent 60%), radial-gradient(900px 600px at 120% 20%, rgba(59,208,255,.12), transparent 60%), linear-gradient(180deg, var(--bg), var(--bg2) 50%, var(--bg))';
});

// Simple router + New Case button visibility
const navDashboard = document.getElementById('navDashboard');
const navCreate = document.getElementById('navCreate');
const navCases = document.getElementById('navCases');
const btnNewCase = document.getElementById('btnNewCase');
const pageTitle = document.getElementById('pageTitle');
const pageSub = document.getElementById('pageSub');
function setPage(hash){
  document.querySelectorAll('nav a').forEach(a=>a.removeAttribute('aria-current'));
  document.getElementById('pageDashboard').classList.add('hidden');
  document.getElementById('pageCreate').classList.add('hidden');
  document.getElementById('pageAllCases').classList.add('hidden');
  if(hash==='#create'){
    document.getElementById('pageCreate').classList.remove('hidden');
    navCreate.setAttribute('aria-current','page');
    btnNewCase.classList.add('hidden'); // Hide on create
    pageTitle.textContent='Create New Case';
    pageSub.textContent='Guided, compact, user-friendly entry';
  } else if(hash==='#cases'){
    document.getElementById('pageAllCases').classList.remove('hidden');
    navCases.setAttribute('aria-current','page');
    btnNewCase.classList.remove('hidden');
    pageTitle.textContent='All Cases';
    pageSub.textContent='Browse, filter, and manage';
  } else {
    document.getElementById('pageDashboard').classList.remove('hidden');
    navDashboard.setAttribute('aria-current','page');
    btnNewCase.classList.remove('hidden');
    pageTitle.textContent='Dashboard';
    pageSub.textContent='Quick insights & recent activity';
  }
}
window.addEventListener('hashchange', ()=>setPage(location.hash));
btnNewCase.addEventListener('click', ()=>{ location.hash='#create'; });
setPage(location.hash || '#dashboard');

// TFS optional checkbox
const tfsToggle = document.getElementById('tfsToggle');
const tfsField = document.getElementById('tfsField');
if(tfsToggle){
  tfsToggle.addEventListener('change', ()=>{
    tfsField.classList.toggle('hidden', !tfsToggle.checked);
  });
}

// Machine type -> model list
const machineType = document.getElementById('machineType');
const modelSelect = document.getElementById('modelSelect');
function fillModels(kind){
  modelSelect.innerHTML='';
  const max = 50;
  const prefix = (kind==='duplex') ? 'D' : 'S';
  const frag = document.createDocumentFragment();
  const ph = document.createElement('option'); ph.textContent='Select model…'; ph.value=''; frag.appendChild(ph);
  for(let i=1;i<=max;i++){
    const opt=document.createElement('option');
    opt.textContent = prefix + i;
    opt.value = prefix + i;
    frag.appendChild(opt);
  }
  modelSelect.appendChild(frag);
}
let currentType='simplex'; fillModels(currentType);
if(machineType){
  machineType.addEventListener('click', (e)=>{
    if(!e.target.classList.contains('chip')) return;
    machineType.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
    e.target.classList.add('active');
    currentType=e.target.dataset.type; fillModels(currentType);
  });
}

// System -> Subsystem (using your official list; subsystems placeholder only)
const systemSelect = document.getElementById('systemSelect');
const subsystemField = document.getElementById('subsystemField');
const subsystemSelect = document.getElementById('subsystemSelect');

const systems = [
  "Machine","BSS","STS","IPS","BCU","IRD","Hot Air","PSS","CWS","Ventilation",
  "MSPS","ITS","EC","DFE","PQ","QCS","PC Cabinet","ICS"
];
(function initSystems(){
  systems.forEach(k=>{
    const opt=document.createElement('option'); opt.value=k; opt.textContent=k; systemSelect.appendChild(opt);
  });
})();
systemSelect.addEventListener('change', ()=>{
  if(!systemSelect.value){
    subsystemField.classList.add('hidden');
    subsystemSelect.innerHTML='<option value=\"\">Select subsystem…</option>';
    return;
  }
  // Placeholder only; will populate once you provide mappings
  subsystemSelect.innerHTML='<option value=\"\">Select subsystem…</option>';
  subsystemField.classList.remove('hidden');
});

// Part smart suggest (client side demo)
const partInput = document.getElementById('partInput');
const partSuggest = document.getElementById('partSuggest');
if(partInput){
  const parts = Array.from({length:120}, (_,i)=>{
    const base = (i%2===0) ? '12' : '34';
    const tail = String(10000+i).slice(-5);
    return `${base}-${tail}`;
  });
  function filterParts(q){
    const v = q.trim().toLowerCase();
    if(!v) return [];
    return parts.filter(p=>p.toLowerCase().includes(v)).slice(0,30);
  }
  partInput.addEventListener('input', ()=>{
    const list = filterParts(partInput.value);
    partSuggest.innerHTML='';
    if(!list.length){ partSuggest.style.display='none'; return; }
    list.forEach(p=>{
      const row=document.createElement('div'); row.textContent=p;
      row.addEventListener('click', ()=>{ partInput.value=p; partSuggest.style.display='none'; });
      partSuggest.appendChild(row);
    });
    partSuggest.style.display='block';
  });
  document.addEventListener('click',(e)=>{
    if(!partSuggest.contains(e.target) && e.target!==partInput){ partSuggest.style.display='none'; }
  });
}

// Troubleshooting steps list
const steps = document.getElementById('steps');
const addStepBtn = document.getElementById('addStep');
function addStep(val=''){
  const row=document.createElement('div'); row.className='step';
  const input=document.createElement('input'); input.placeholder='Describe a step…'; input.value=val;
  const del=document.createElement('button'); del.type='button'; del.className='del'; del.textContent='Remove';
  del.addEventListener('click', ()=> row.remove());
  row.appendChild(input); row.appendChild(del);
  steps.appendChild(row);
}
if(addStepBtn){
  addStepBtn.addEventListener('click', ()=> addStep());
  addStep('Check connections and sensors');
  addStep('Verify model-specific settings');
}
</script>
</body>
</html>